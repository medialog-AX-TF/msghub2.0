# 메시지허브 요구사항 명세서

## 1. 프로젝트 개요

메시지허브는 다양한 메시징 채널(SMS, LMS, MMS, RCS, 카카오톡 등)을 통합하여 관리하고 발송할 수 있는 웹 기반 메시징 플랫폼입니다. 본 프로젝트는 AI 어시스턴트를 통해 사용자 경험을 향상시키고 업무 효율성을 높이는 기능을 구현하는 것을 목표로 합니다.

### 1.1 목적

- 다양한 메시징 채널을 통합하여 효율적인 메시지 발송 및 관리 제공
- AI 어시스턴트를 통한 자연어 기반 웹사이트 자동화 구현
- 사용자 경험 향상 및 업무 효율성 증대

### 1.2 지원 LLM 모델

메시지허브는 다양한 LLM 모델을 지원해야 합니다:

#### 1.2.1 필수 지원 모델
- **Claude 모델**
  - Claude 3 Opus: 가장 강력한 성능, 복잡한 작업에 적합
  - Claude 3 Sonnet: 균형 잡힌 성능과 속도
  - Claude 3 Haiku: 빠른 응답 속도, 간단한 작업에 적합

- **OpenAI 모델**
  - GPT-4o: 최신 멀티모달 모델, 이미지 처리 가능
  - GPT-4: 강력한 추론 능력
  - GPT-3.5 Turbo: 빠른 응답 속도, 비용 효율적

#### 1.2.2 선택적 지원 모델
- **Google 모델**
  - Gemini Pro: Google의 고성능 LLM
  - Gemini Flash: 빠른 응답 속도 제공

- **오픈소스 모델**
  - Llama 3: Meta의 오픈소스 모델
  - Mistral: 경량화된 고성능 모델

#### 1.2.3 모델 선택 및 관리 기능
- .env 환경 설정 파일을 통한 기본 LLM 모델 설정
- 환경 변수를 통한 모델 전환 및 설정 관리
- 모델 API 키 및 설정 관리
- 모델 변경 시 서버 재시작 또는 환경 변수 리로드 필요

## 2. 시스템 아키텍처

메시지허브는 다음과 같은 구조로 설계되어야 합니다:

```
웹사이트 <-> AI 어시스턴트 <-> LLM <-> 웹사이트 자동화
```

### 2.1 작동 흐름

1. **사용자 입력**: 사용자가 AI 어시스턴트 사이드바를 통해 자연어로 요청을 입력합니다.
2. **AI 어시스턴트 처리**: 시스템 프롬프트, 도구 정의, 사용자 프롬프트를 포함한 컨텍스트를 LLM에 전달합니다.
3. **LLM 의도 분석**: LLM이 사용자의 의도를 분석하고 적절한 도구와 파라미터를 선택합니다.
4. **도구 실행**: 선택된 도구가 웹사이트의 특정 기능을 실행합니다.
5. **결과 반환**: 실행 결과가 사용자에게 반환됩니다.

### 2.2 AI 어시스턴트 컨텍스트 구성

#### 2.2.1 시스템 프롬프트
- 어시스턴트의 역할 및 목적 정의
- 메시지허브 웹사이트의 구조 및 기능 설명
- 도구 사용 지침 및 제약사항
- 응답 형식 및 스타일 가이드라인

#### 2.2.2 도구 정의
각 도구는 JSON 스키마 형식으로 정의되어야 하며, 다음 정보를 포함해야 합니다:
- 도구 이름
- 도구 설명
- 필수 및 선택적 매개변수
- 매개변수 타입 및 제약조건
- 반환 값 형식

#### 2.2.3 사용자 프롬프트
- 사용자 입력을 LLM에 전달
- 이전 대화 컨텍스트 유지

### 2.3 도구 목록

웹사이트 자동화를 위한 도구 목록은 다음과 같습니다:

1. **navigate_to**: 특정 메뉴 또는 URL로 이동
   - 매개변수: `menu_name` 또는 `url`
   - 반환: 이동 성공 여부

2. **click_element**: 버튼, 링크, 체크박스 등 요소 클릭
   - 매개변수: `element_id` 또는 `element_selector`
   - 반환: 클릭 성공 여부

3. **input_text**: 텍스트 필드에 내용 입력
   - 매개변수: `element_id`, `text`
   - 반환: 입력 성공 여부

4. **select_option**: 드롭다운 메뉴에서 옵션 선택
   - 매개변수: `element_id`, `option_value` 또는 `option_text`
   - 반환: 선택 성공 여부

5. **upload_file**: 파일 업로드 기능 실행
   - 매개변수: `element_id`, `file_path`
   - 반환: 업로드 성공 여부

6. **download_file**: 파일 다운로드 기능 실행
   - 매개변수: `file_url` 또는 `element_id`
   - 반환: 다운로드 성공 여부

7. **extract_data**: 웹 페이지에서 데이터 추출
   - 매개변수: `selector` 또는 `xpath`
   - 반환: 추출된 데이터

8. **fill_form**: 여러 필드가 있는 양식 자동 작성
   - 매개변수: `form_id`, `form_data` (JSON 객체)
   - 반환: 작성 성공 여부

9. **submit_form**: 작성된 양식 제출
   - 매개변수: `form_id`
   - 반환: 제출 성공 여부

10. **confirm_dialog**: 확인/취소 대화상자 응답
    - 매개변수: `action` (confirm/cancel)
    - 반환: 응답 성공 여부

## 3. 기능 요구사항

### 3.1 AI 어시스턴트 사이드바

#### 3.1.1 UI 요구사항
- 우측에 위치한 접을 수 있는 사이드바 형태
- 사용자와 AI 간의 대화형 인터페이스 제공
- 메시지 입력 필드 및 전송 버튼
- 대화 내역 표시 영역
- 빠른 액션 버튼 제공
- 모바일 환경에서 토글 가능한 UI

#### 3.1.2 기능 요구사항
- 사용자 입력 처리 및 LLM에 전달
- LLM 응답 표시 및 포맷팅
- 대화 내역 저장 및 관리
- 타이핑 표시기 제공
- 빠른 액션 버튼을 통한 일반적인 작업 단축키 제공

### 3.2 자연어 기반 웹사이트 자동화

#### 3.2.1 의도 파악 및 도구 선택
- 사용자 입력에서 의도 파악
- 적절한 도구 선택 및 매개변수 추출
- 도구 실행 및 결과 처리

#### 3.2.2 자동화 시나리오
- 메뉴 이동 및 페이지 탐색
- 양식 작성 및 제출
- 데이터 추출 및 분석
- 파일 업로드 및 다운로드

### 3.3 메시지 발송 기능

#### 3.3.1 템플릿 관리
- 템플릿 검색 및 선택
- 템플릿 생성 및 수정
- 템플릿 미리보기

#### 3.3.2 발송 관리
- 수신자 목록 관리
- 발송 예약 및 취소
- 발송 상태 모니터링

#### 3.3.3 결과 분석
- 발송 결과 조회
- 통계 데이터 분석
- 보고서 생성

## 4. 사용자 시나리오

### 4.1 템플릿 검색 및 발송

**사용자**: "7월 프로모션 템플릿 찾아서 발송해줘"

**AI 어시스턴트**:
1. 의도 파악: 템플릿 검색 및 발송
2. 도구 실행: `navigate_to` (템플릿 페이지로 이동)
3. 도구 실행: `input_text` (검색어 "7월 프로모션" 입력)
4. 도구 실행: `click_element` (검색 버튼 클릭)
5. 도구 실행: `extract_data` (검색 결과 추출)
6. 사용자에게 결과 표시: "7월 프로모션 안내 템플릿을 찾았습니다. 이 템플릿으로 발송하시겠어요?"
7. 사용자 확인 후 발송 프로세스 진행

### 4.2 발송 결과 조회

**사용자**: "어제 발송한 메시지 결과 보여줘"

**AI 어시스턴트**:
1. 의도 파악: 발송 결과 조회
2. 도구 실행: `navigate_to` (조회 페이지로 이동)
3. 도구 실행: `select_option` (날짜 범위 "어제" 선택)
4. 도구 실행: `click_element` (검색 버튼 클릭)
5. 도구 실행: `extract_data` (결과 데이터 추출)
6. 사용자에게 결과 표시: "어제 발송한 메시지 결과입니다: 총 1,245건, 성공 1,230건(98.8%), 실패 15건(1.2%)"

### 4.3 새 템플릿 생성

**사용자**: "새 알림톡 템플릿 만들어줘"

**AI 어시스턴트**:
1. 의도 파악: 새 템플릿 생성
2. 도구 실행: `navigate_to` (템플릿 페이지로 이동)
3. 도구 실행: `click_element` (템플릿 등록 버튼 클릭)
4. 도구 실행: `select_option` (템플릿 유형 "알림톡" 선택)
5. 사용자에게 추가 정보 요청: "템플릿 이름과 내용을 알려주세요."
6. 사용자 응답 후 템플릿 생성 프로세스 진행

### 4.4 LLM 모델 변경

**관리자**: "LLM 모델을 GPT-4로 변경하고 싶습니다."

**절차**:
1. .env 파일에서 `DEFAULT_LLM_MODEL=gpt-4` 설정
2. 필요한 경우 `OPENAI_API_KEY` 확인 및 설정
3. 서버 재시작 또는 환경 변수 리로드
4. 모델 변경 확인

## 5. 기술 요구사항

### 5.1 프론트엔드

- HTML5, CSS3, JavaScript (ES6+)
- 반응형 웹 디자인
- 크로스 브라우저 호환성 (Chrome, Firefox, Safari, Edge)

### 5.2 백엔드

- Node.js, Express
- RESTful API 설계
- 환경 변수 관리 (.env)
- 에러 처리 및 로깅

### 5.3 데이터베이스

- MongoDB
- 데이터 모델링 및 스키마 설계
- 인덱싱 및 쿼리 최적화

### 5.4 AI 통합

- LLM API 연동 (Claude, OpenAI, Gemini 등)
- 프롬프트 엔지니어링
- 도구 정의 및 실행 로직
- 컨텍스트 관리

### 5.5 보안

- API 키 보안 관리
- 사용자 인증 및 권한 관리
- 입력 검증 및 이스케이핑
- HTTPS 통신

## 6. 성능 요구사항

### 6.1 응답 시간

- AI 어시스턴트 초기 응답: 1초 이내
- LLM 응답 시간: 3초 이내 (모델에 따라 다를 수 있음)
- 웹사이트 자동화 작업: 작업 복잡도에 따라 다름 (사용자에게 진행 상황 표시)

### 6.2 동시 사용자

- 최소 100명의 동시 사용자 지원
- 부하 증가에 따른 성능 저하 최소화

### 6.3 확장성

- 사용자 증가에 따른 수평적 확장 가능
- 새로운 LLM 모델 추가 용이성
- 새로운 도구 및 기능 추가 용이성

## 7. 구현 우선순위

1. AI 어시스턴트 사이드바 구조 및 기본 UI
2. LLM 연동 및 기본 대화 기능
3. 웹사이트 자동화 도구 정의 및 구현
4. 템플릿 검색 및 발송 시나리오 구현
5. 발송 결과 조회 시나리오 구현
6. 템플릿 생성 시나리오 구현
7. 다양한 LLM 모델 지원 및 전환 기능
8. 성능 최적화 및 보안 강화
9. 사용자 경험 개선 및 UI 개선

## 8. 제약사항

- LLM API 호출 비용 고려 (토큰 사용량 최적화)
- 브라우저 호환성 제약 (IE 지원 불필요)
- 모바일 환경에서의 UI 제약
- API 호출 제한 및 속도 제한 고려

## 9. 향후 확장 계획

- 음성 인식을 통한 프롬프트 입력 지원
- 다국어 지원
- 고급 분석 및 인사이트 제공
- 사용자 맞춤형 추천 기능
- 런타임 환경 변수 변경 기능 (서버 재시작 없이 모델 전환)
- 추가 메시징 채널 통합 (WhatsApp, Line 등) 